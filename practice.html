<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Stock Chart with Tooltip</title>
  <style>
    body {
      background-color: #0B1325;
      font-family: monospace;
      color: white;
      margin: 0;
      padding: 20px;
    }

    .container {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    #chart {
      width: 900px;
      height: 450px;
    }

    #tooltip {
      background-color: #111827;
      padding: 12px 16px;
      border-radius: 10px;
      box-shadow: 0 0 8px #000;
      min-width: 140px;
      position: absolute;
    }

    #tooltip div {
      margin-bottom: 6px;
    }

    #tooltip span {
      float: right;
    }
  </style>
  <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
</head>

<body>

  <div class="container">
    <div id="chart"></div>
    <div id="tooltip">
      <div>Time: <span>--</span></div>
      <div>Open: <span>$--</span></div>
      <div>High: <span>$--</span></div>
      <div>Low: <span>$--</span></div>
      <div>Close: <span>$--</span></div>
    </div>
  </div>

  <script>
    const chart = LightweightCharts.createChart(document.getElementById('chart'), {
      layout: {
        background: { color: '#0B1325' },
        textColor: '#d1d4dc',
      },
      grid: {
        vertLines: { color: '#2B2B43' },
        horzLines: { color: '#363C4E' },
      },
      crosshair: {
        mode: LightweightCharts.CrosshairMode.Normal,
      },
      timeScale: {
        timeVisible: true,
        secondsVisible: false,
      },
    });

    const candleSeries = chart.addCandlestickSeries({
      upColor: '#26a69a',
      downColor: '#ef5350',
      wickUpColor: '#26a69a',
      wickDownColor: '#ef5350',
      borderVisible: false,
    });

    // Sample data
    const sampleData = [
      { time: 1719723000, open: 172.84, high: 174.16, low: 172.84, close: 173.36, volume: 1179526 },
      { time: 1719726600, open: 172.08, high: 174.06, low: 170.81, close: 173.76, volume: 779345 },
      { time: 1719730200, open: 173.00, high: 175.12, low: 172.32, close: 174.00, volume: 985000 },
      { time: 1719733800, open: 174.20, high: 175.90, low: 173.80, close: 175.50, volume: 1048320 },
      { time: 1719737400, open: 175.60, high: 176.40, low: 174.90, close: 175.20, volume: 894512 },
    ];

    candleSeries.setData(sampleData);

    const tooltip = document.getElementById('tooltip');
    const [timeEl, openEl, highEl, lowEl, closeEl] = tooltip.querySelectorAll("span");

    chart.subscribeCrosshairMove(param => {
      if (!param || !param.time || !param.seriesData.has(candleSeries)) {
        timeEl.textContent = openEl.textContent = highEl.textContent = lowEl.textContent = closeEl.textContent  = "--";
        return;
      }

      const data = param.seriesData.get(candleSeries);
      const time = new Date(param.time * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true });

      timeEl.textContent = time;
      openEl.textContent = `$${data.open.toFixed(2)}`;
      highEl.textContent = `$${data.high.toFixed(2)}`;
      lowEl.textContent = `$${data.low.toFixed(2)}`;
      closeEl.textContent = `$${data.close.toFixed(2)}`;
      
      const rect = document.getElementById('chart').getBoundingClientRect();
      console.log( rect.left, window.scrollX, param.point.x)
      tooltip.style.left = rect.left + window.scrollX + param.point.x + 20 + 'px'; // rect.left - hori dist of chart from left window
      tooltip.style.top = rect.top + window.scrollY + param.point.y + 20 + 'px'; // param.point.x - hori dist of candle form left chart
    });

    tooltip.style.position = 'absolute';
    tooltip.style.zIndex = '10';

  </script>

</body>

</html>
